image: node

stages:
  - build
  - deploy

build_job:
  stage: build
  script: 'npm install && npm run build && tar -czvf front.tar.gz dist'
  artifacts:
    paths:
    - front.tar.gz
    
deploy_job:
  stage: deploy
  environment: test
  before_script:   
  - 'which ssh-agent || ( apt-get update -y && apt-get install openssh-client -y )'   
  - eval $(ssh-agent -s)   
  - ssh-add <(echo "$SSH_PRIVATE_KEY")   
  - mkdir -p ~/.ssh   
  - echo -e "Host *\n\tStrictHostKeyChecking no\n\n" > ~/.ssh/config   
  script:   
  - scp front.tar.gz gitlab-ci@40.68.243.107:~/pr/front
  dependencies:   
  - build_job